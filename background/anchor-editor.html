<!DOCTYPE html>
<html><head><style>
body { background: #0a0e1a; margin: 0; padding: 20px; font-family: sans-serif; color: #fff; }
h1 { color: #d4af37; text-align: center; margin-bottom: 10px; }
.info { text-align: center; margin-bottom: 20px; color: #888; }
.container { display: flex; justify-content: center; gap: 30px; }
canvas { border: 1px solid #444; cursor: crosshair; }
.controls { background: #1a1f3d; padding: 15px; border-radius: 8px; min-width: 280px; }
.controls h3 { color: #d4af37; margin-bottom: 15px; }
.control-row { margin-bottom: 10px; }
.control-row label { display: inline-block; width: 120px; }
.control-row input { width: 60px; background: #252a4a; border: 1px solid #444; color: #fff; padding: 4px; }
button { background: #d4af37; color: #000; border: none; padding: 8px 16px; cursor: pointer; margin: 5px; border-radius: 4px; }
button:hover { background: #f0c040; }
#output { background: #252a4a; padding: 10px; margin-top: 15px; font-family: monospace; font-size: 12px; white-space: pre; }
.instructions { color: #aaa; font-size: 12px; margin-top: 10px; }
</style></head><body>
<h1>Anchor Alignment Editor</h1>
<p class="info">Click on the silhouette to set anchor positions. Yellow dots = anchors, White dots = constellation stars</p>
<div class="container">
  <canvas id="canvas" width="512" height="512"></canvas>
  <div class="controls">
    <h3>Anchor Settings</h3>
    <div class="control-row">
      <label>Anchor 1 (star 3):</label>
      X: <input type="number" id="a1x" value="435"> Y: <input type="number" id="a1y" value="163">
    </div>
    <div class="control-row">
      <label>Anchor 2 (star 19):</label>
      X: <input type="number" id="a2x" value="75"> Y: <input type="number" id="a2y" value="145">
    </div>
    <div class="control-row">
      <label>Silhouette Scale:</label>
      <input type="number" id="scale" value="0.93" step="0.1" style="width:60px">
    </div>
    <button onclick="redraw()">Update</button>
    <button onclick="copyConfig()">Copy Config</button>
    <p class="instructions">Click canvas to set anchors:<br>- Left click = Anchor 1<br>- Right click = Anchor 2</p>
    <div id="output"></div>
  </div>
</div>
<script type="module">
import { CONSTELLATIONS } from './constellationData.js';
const data = CONSTELLATIONS.ANDROMEDA;
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.src = 'silhouettes/andromeda.png';

let a1x = 435, a1y = 163, a2x = 75, a2y = 145, scaleVal = 0.93;

// Calculate star positions on 512x512 canvas
let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
data.stars.forEach(([x, y]) => { minX = Math.min(minX, x); maxX = Math.max(maxX, x); minY = Math.min(minY, y); maxY = Math.max(maxY, y); });
const padding = 50;
const scale = Math.min((512 - padding * 2) / (maxX - minX), (512 - padding * 2) / (maxY - minY));
const offsetX = (512 - (maxX - minX) * scale) / 2;
const offsetY = (512 - (maxY - minY) * scale) / 2;
const transform = (x, y) => [(x - minX) * scale + offsetX, (y - minY) * scale + offsetY];
const starPositions = data.stars.map(([x, y]) => transform(x, y));

window.redraw = function() {
    a1x = parseInt(document.getElementById('a1x').value);
    a1y = parseInt(document.getElementById('a1y').value);
    a2x = parseInt(document.getElementById('a2x').value);
    a2y = parseInt(document.getElementById('a2y').value);
    scaleVal = parseFloat(document.getElementById('scale').value);
    draw();
};

window.copyConfig = function() {
    const config = '"anchors": [{ "starIndex": 3, "imgPos": [' + a1x + ', ' + a1y + '] }, { "starIndex": 19, "imgPos": [' + a2x + ', ' + a2y + '] }], "silhouetteScale": ' + scaleVal;
    navigator.clipboard.writeText(config);
    document.getElementById('output').textContent = 'Copied! ' + config;
};

function draw() {
    ctx.fillStyle = '#0a0e1a';
    ctx.fillRect(0, 0, 512, 512);
    
    if (!img.complete) return;
    
    const s1 = starPositions[3], s2 = starPositions[19];
    const imgDist = Math.hypot(a2x - a1x, a2y - a1y);
    const canvasDist = Math.hypot(s2[0] - s1[0], s2[1] - s1[1]);
    const imgScale = canvasDist / imgDist;
    const finalScale = imgScale * scaleVal;
    const imgW = 512 * finalScale, imgH = 512 * finalScale;
    const baseW = 512 * imgScale, baseH = 512 * imgScale;
    const drawX = s1[0] - a1x * imgScale - (imgW - baseW) / 2;
    const drawY = s1[1] - a1y * imgScale - (imgH - baseH) / 2;
    
    ctx.shadowBlur = 20; ctx.shadowColor = 'rgba(100,149,237,0.8)'; ctx.globalAlpha = 0.85;
    ctx.drawImage(img, drawX, drawY, imgW, imgH);
    ctx.shadowBlur = 0; ctx.globalAlpha = 1;
    
    // Draw lines
    ctx.strokeStyle = 'rgba(100,149,237,0.7)'; ctx.lineWidth = 2;
    data.connections.forEach(([i, j]) => { ctx.beginPath(); ctx.moveTo(...starPositions[i]); ctx.lineTo(...starPositions[j]); ctx.stroke(); });
    
    // Draw stars
    starPositions.forEach(([tx, ty], i) => {
        ctx.beginPath(); ctx.arc(tx, ty, 6, 0, Math.PI * 2);
        ctx.fillStyle = (i === 3 || i === 19) ? '#ff0' : '#fff';
        ctx.fill();
        ctx.fillStyle = '#fff'; ctx.font = '10px monospace';
        ctx.fillText(i, tx + 8, ty + 3);
    });
    
    document.getElementById('output').textContent = 'A1:[' + a1x + ',' + a1y + '] A2:[' + a2x + ',' + a2y + '] Scale:' + scaleVal;
}

canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = Math.round((e.clientX - rect.left) * (512 / rect.width));
    const y = Math.round((e.clientY - rect.top) * (512 / rect.height));
    document.getElementById('a1x').value = x;
    document.getElementById('a1y').value = y;
    a1x = x; a1y = y;
    draw();
});

canvas.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const x = Math.round((e.clientX - rect.left) * (512 / rect.width));
    const y = Math.round((e.clientY - rect.top) * (512 / rect.height));
    document.getElementById('a2x').value = x;
    document.getElementById('a2y').value = y;
    a2x = x; a2y = y;
    draw();
});

img.onload = draw;
draw();
</script></body></html>